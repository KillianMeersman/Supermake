export GOCACHE = /tmp/.cache

build:
	go mod tidy
	go build -o bin/supermake

test:
	env
	go test -v -race ./...

all: linux mac windows

mac: test
	echo 'Building mac binary'

	@golang:1.20
	GOOS=darwin GOARCH=amd64 go build -buildvcs=false -o bin/supermake_darwin_64

linux: test
	echo 'Building linux binaries'

	@golang:1.20
	GOOS=linux GOARCH=amd64 go build -buildvcs=false -o bin/supermake_linux_64
	GOOS=linux GOARCH=386 go build -buildvcs=false -o bin/supermake_linux_32

windows: test
	echo 'Building windows binaries'

	@golang:1.20
	GOOS=windows GOARCH=amd64 go build -buildvcs=false -o bin/supermake_windows_64.exe
	GOOS=windows GOARCH=386 go build -buildvcs=false -o bin/supermake_windows_32.exe

install: build uninstall
	sudo cp -f bin/supermake /usr/local/bin/supermake
	sudo cp -l /usr/local/bin/supermake /usr/local/bin/smake

uninstall:
	sudo rm -f /usr/local/bin/supermake /usr/local/bin/smake

clean:
	rm -rf bin .cache || true
